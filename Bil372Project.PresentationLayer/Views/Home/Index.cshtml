@model Bil372Project.PresentationLayer.Models.DashboardViewModel

@{
    Layout = "~/Views/Shared/_MainLayout.cshtml";
    ViewData["Title"] = "Gösterge Paneli";
}

<div class="glass-card mb-4">
    <div class="row g-4 align-items-center">
        <div class="col-lg-7">
            <h2 class="fw-bold mb-3">Merhaba! Bugün kendin için ne yapacaksın?</h2>
            <p class="text-muted mb-4"></p>
            <div class="d-flex flex-wrap gap-3">
                <a asp-action="Values" class="btn btn-primary btn-lg px-4">
                    <i class="bi bi-pencil-square me-2"></i> Değerlerimi Güncelle
                </a>
                <a asp-action="NewProgram" class="btn btn-outline-info btn-lg px-4">
                    <i class="bi bi-stars me-2"></i> Yeni Program Oluştur
                </a>
            </div>
        </div>
        <div class="col-lg-5">
            <div class="position-relative p-4 rounded-4 text-white" style="background: linear-gradient(135deg,#30d0d0,#0575e6);">
                <h5 class="text-uppercase text-white-50">Günün İpucu</h5>
                <p class="fs-5 fw-semibold mb-4">Su tüketimini takip et! Her saat başı bir bardak su içmek enerji seviyeni korumana yardımcı olur.</p>
                <span class="badge bg-white text-primary fw-semibold px-3 py-2">Hedef: 8 Bardak</span>
            </div>
        </div>
    </div>
</div>

<div class="stat-grid">
    <div class="stat-card">
        <h5>Güncel Kilo</h5>
        <span class="value">
            @if (Model.CurrentWeightKg.HasValue)
            {
                @Model.CurrentWeightKg.Value.ToString("0.0") <small class="fs-6">kg</small>
            }
            else
            {
                @:-
            }
        </span>

        @if (Model.WeightChangeLastMonthKg.HasValue)
        {
            var diff = Model.WeightChangeLastMonthKg.Value;
            if (diff < 0)
            {
                <span class="text-success fw-semibold">
                    <i class="bi bi-arrow-down-right me-1"></i>
                    Son ay @Math.Abs(diff).ToString("0.0") kg azaldı
                </span>
            }
            else if (diff > 0)
            {
                <span class="text-danger fw-semibold">
                    <i class="bi bi-arrow-up-right me-1"></i>
                    Son ay @diff.ToString("0.0") kg arttı
                </span>
            }
            else
            {
                <span class="text-muted fw-semibold">
                    Son ay kilon değişmedi
                </span>
            }
        }
        else
        {
            <span class="text-muted fw-semibold">
                Son ay için yeterli veri yok
            </span>
        }
    </div>

    <div class="stat-card">
        <h5>BMI</h5>
        <span class="value">
            @(Model.CurrentBmi.HasValue ? Model.CurrentBmi.Value.ToString("0.0") : "-")
        </span>
        <span class="text-muted">
            @(!string.IsNullOrEmpty(Model.BmiCategory) ? Model.BmiCategory : "Henüz hesaplanmadı")
        </span>
    </div>

    <div class="stat-card">
        <h5>Haftalık Aktivite</h5>
        <span class="value">5 <small class="fs-6">seans</small></span>
        <span class="text-muted">Hedef: 4 seans</span>
    </div>
    <div class="stat-card">
        <h5>Su Takibi</h5>
        <span class="value">8</span>
        <span class="text-muted">Hadi 8 bardak su içelim bugün!</span>
    </div>
</div>

<div class="row g-4 mt-1">
    <div class="col-xl-7">
        <div class="glass-card h-100">
            <h4 class="section-title">Bugünkü Planın</h4>

            @if (Model.TodayPlan == null)
            {
                <p class="text-muted mt-3 mb-0">
                    Henüz bir beslenme programı oluşturmadın. 
                    <a asp-controller="Home" asp-action="NewProgram">Buradan yeni bir program oluşturabilirsin.</a>
                </p>
            }
            else
            {
                <table class="table-modern">
                    <thead>
                    <tr>
                        <th>Öğün</th>
                        <th>Öneri</th>
                        <th>Kalori</th>
                        <th></th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td class="fw-semibold">Kahvaltı</td>
                        <td>@Model.TodayPlan.Breakfast</td>
                        <td>—</td> @* Şu an AI’dan kalori dönmediği için boş bırakıyoruz *@
                        <td><span class="badge-soft">Hazır</span></td>
                    </tr>
                    <tr>
                        <td class="fw-semibold">Öğle</td>
                        <td>@Model.TodayPlan.Lunch</td>
                        <td>—</td>
                        <td><span class="badge-soft">Hazır</span></td>
                    </tr>
                    <tr>
                        <td class="fw-semibold">Akşam</td>
                        <td>@Model.TodayPlan.Dinner</td>
                        <td>—</td>
                        <td><span class="badge-soft">Hazır</span></td>
                    </tr>
                    <tr>
                        <td class="fw-semibold">Ara Öğün</td>
                        <td>@Model.TodayPlan.Snack</td>
                        <td>—</td>
                        <td><span class="badge-soft">Hazır</span></td>
                    </tr>
                    </tbody>
                </table>

                <p class="text-muted small mb-0">
                    Oluşturulma zamanı: @Model.TodayPlan.GeneratedAt.ToLocalTime().ToString("dd MMM yyyy HH:mm")
                </p>
            }
        </div>
    </div>
    <div class="col-xl-5">
        <div class="glass-card h-100">
            <h4 class="section-title">Motivasyon</h4>
            <div class="program-step">
                <div class="step-index">1</div>
                <div>
                    <h6>Günün hedefini belirle</h6>
                    <p class="text-muted small mb-0">Bugün 8.000 adım atmayı hedefle ve uygulamada işaretlemeyi unutma.</p>
                </div>
            </div>
            <div class="program-step">
                <div class="step-index">2</div>
                <div>
                    <h6>Esneme molaları ekle</h6>
                    <p class="text-muted small mb-0">Her 90 dakikada bir 5 dakikalık esneme planla. Vücudunu dinç tut!</p>
                </div>
            </div>
            <div class="program-step mb-0">
                <div class="step-index">3</div>
                <div>
                    <h6>Akşam değerlendirmesi yap</h6>
                    <p class="text-muted small mb-0">Günün sonunda hislerini not al, hedeflerine ne kadar yaklaştığını gözden geçir.</p>
                </div>
            </div>
        </div>
    </div>
</div>
